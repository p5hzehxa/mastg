rules:
  - id: mastg-android-biometric-device-credential-fallback
    languages:
      - java
    severity: WARNING
    metadata:
      summary: This rule detects BiometricPrompt configurations that allow fallback to device credentials.
    message: "[MASVS-AUTH] BiometricPrompt allows fallback to device credentials. For sensitive operations, consider using BIOMETRIC_STRONG only."
    pattern-either:
      - pattern: |
          $BUILDER.setAllowedAuthenticators(... | BiometricManager.Authenticators.DEVICE_CREDENTIAL | ...)
      - pattern: |
          $BUILDER.setAllowedAuthenticators(BiometricManager.Authenticators.DEVICE_CREDENTIAL)
      - pattern: |
          $BUILDER.setDeviceCredentialAllowed(true)
      - pattern: |
          $BM.canAuthenticate(... | BiometricManager.Authenticators.DEVICE_CREDENTIAL | ...)
      - pattern: |
          $BM.canAuthenticate(BiometricManager.Authenticators.DEVICE_CREDENTIAL)
